<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web Component | Jerry 个人博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script>
      (function() {
        var mta = document.createElement("script");
        mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
        mta.setAttribute("name", "MTAH5");
        mta.setAttribute("sid", "500708667");
        mta.setAttribute("cid", "500708668");
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(mta, s);
      })();
    </script>
    <script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="Jerry's blog">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.06744937.css" as="style"><link rel="preload" href="/assets/js/app.60e74413.js" as="script"><link rel="preload" href="/assets/js/14.69f023c0.js" as="script"><link rel="preload" href="/assets/js/2.720ba71e.js" as="script"><link rel="preload" href="/assets/js/12.aeedaf60.js" as="script"><link rel="prefetch" href="/assets/js/10.4356ad27.js"><link rel="prefetch" href="/assets/js/100.c99580b9.js"><link rel="prefetch" href="/assets/js/101.356781a9.js"><link rel="prefetch" href="/assets/js/11.b045add9.js"><link rel="prefetch" href="/assets/js/13.fb627b38.js"><link rel="prefetch" href="/assets/js/15.9fedbce0.js"><link rel="prefetch" href="/assets/js/16.1a7de72a.js"><link rel="prefetch" href="/assets/js/17.fa224a6a.js"><link rel="prefetch" href="/assets/js/18.1a72bef8.js"><link rel="prefetch" href="/assets/js/19.e11c0116.js"><link rel="prefetch" href="/assets/js/20.6a6f73dd.js"><link rel="prefetch" href="/assets/js/21.56a777d3.js"><link rel="prefetch" href="/assets/js/22.6773a84c.js"><link rel="prefetch" href="/assets/js/23.136061fb.js"><link rel="prefetch" href="/assets/js/24.7d1837f0.js"><link rel="prefetch" href="/assets/js/25.31ab58df.js"><link rel="prefetch" href="/assets/js/26.a5e7b497.js"><link rel="prefetch" href="/assets/js/27.9609abfa.js"><link rel="prefetch" href="/assets/js/28.bbb9cd06.js"><link rel="prefetch" href="/assets/js/29.8892b17d.js"><link rel="prefetch" href="/assets/js/3.b7eab624.js"><link rel="prefetch" href="/assets/js/30.74b203cc.js"><link rel="prefetch" href="/assets/js/31.f8502b39.js"><link rel="prefetch" href="/assets/js/32.4a6fdb4c.js"><link rel="prefetch" href="/assets/js/33.06378ca2.js"><link rel="prefetch" href="/assets/js/34.0060ef5f.js"><link rel="prefetch" href="/assets/js/35.1635574b.js"><link rel="prefetch" href="/assets/js/36.ba0ea7aa.js"><link rel="prefetch" href="/assets/js/37.1fe72493.js"><link rel="prefetch" href="/assets/js/38.6140df13.js"><link rel="prefetch" href="/assets/js/39.75defbda.js"><link rel="prefetch" href="/assets/js/4.99432b89.js"><link rel="prefetch" href="/assets/js/40.95f6174a.js"><link rel="prefetch" href="/assets/js/41.edc39790.js"><link rel="prefetch" href="/assets/js/42.9dcf7ed0.js"><link rel="prefetch" href="/assets/js/43.027f7ff4.js"><link rel="prefetch" href="/assets/js/44.a7fa2c02.js"><link rel="prefetch" href="/assets/js/45.3bd0a364.js"><link rel="prefetch" href="/assets/js/46.6682a04b.js"><link rel="prefetch" href="/assets/js/47.a61c377c.js"><link rel="prefetch" href="/assets/js/48.1f4bbd9a.js"><link rel="prefetch" href="/assets/js/49.7f23a237.js"><link rel="prefetch" href="/assets/js/5.406f67b1.js"><link rel="prefetch" href="/assets/js/50.2a56a559.js"><link rel="prefetch" href="/assets/js/51.bb97c3da.js"><link rel="prefetch" href="/assets/js/52.446d5740.js"><link rel="prefetch" href="/assets/js/53.e8184b0c.js"><link rel="prefetch" href="/assets/js/54.c9a5e3ed.js"><link rel="prefetch" href="/assets/js/55.97bb4c63.js"><link rel="prefetch" href="/assets/js/56.cb3d973f.js"><link rel="prefetch" href="/assets/js/57.37f3fb00.js"><link rel="prefetch" href="/assets/js/58.0d7c2f4b.js"><link rel="prefetch" href="/assets/js/59.4a2f6def.js"><link rel="prefetch" href="/assets/js/6.95b28193.js"><link rel="prefetch" href="/assets/js/60.b2a604a0.js"><link rel="prefetch" href="/assets/js/61.debbb7b9.js"><link rel="prefetch" href="/assets/js/62.0bd56b0e.js"><link rel="prefetch" href="/assets/js/63.57bf8cbe.js"><link rel="prefetch" href="/assets/js/64.41c1fb35.js"><link rel="prefetch" href="/assets/js/65.f53d1b42.js"><link rel="prefetch" href="/assets/js/66.566689b9.js"><link rel="prefetch" href="/assets/js/67.f5cf077d.js"><link rel="prefetch" href="/assets/js/68.95bc1b6c.js"><link rel="prefetch" href="/assets/js/69.bdc844a1.js"><link rel="prefetch" href="/assets/js/7.6619bfc9.js"><link rel="prefetch" href="/assets/js/70.94a6894a.js"><link rel="prefetch" href="/assets/js/71.4e9ddb06.js"><link rel="prefetch" href="/assets/js/72.2c8413d7.js"><link rel="prefetch" href="/assets/js/73.64fdac61.js"><link rel="prefetch" href="/assets/js/74.a6f66ae3.js"><link rel="prefetch" href="/assets/js/75.9e940b3a.js"><link rel="prefetch" href="/assets/js/76.7e0d8e19.js"><link rel="prefetch" href="/assets/js/77.c67342fb.js"><link rel="prefetch" href="/assets/js/78.a5bd97d1.js"><link rel="prefetch" href="/assets/js/79.3a3e3541.js"><link rel="prefetch" href="/assets/js/8.d0a8a3ed.js"><link rel="prefetch" href="/assets/js/80.97620f66.js"><link rel="prefetch" href="/assets/js/81.0d8341aa.js"><link rel="prefetch" href="/assets/js/82.0d309601.js"><link rel="prefetch" href="/assets/js/83.6123aeae.js"><link rel="prefetch" href="/assets/js/84.00b21399.js"><link rel="prefetch" href="/assets/js/85.d22ae4f9.js"><link rel="prefetch" href="/assets/js/86.a79065fe.js"><link rel="prefetch" href="/assets/js/87.01664722.js"><link rel="prefetch" href="/assets/js/88.1cb8429e.js"><link rel="prefetch" href="/assets/js/89.a36be8c5.js"><link rel="prefetch" href="/assets/js/9.f2277063.js"><link rel="prefetch" href="/assets/js/90.ebfec47e.js"><link rel="prefetch" href="/assets/js/91.47f73c78.js"><link rel="prefetch" href="/assets/js/92.4ae86837.js"><link rel="prefetch" href="/assets/js/93.8bbf0769.js"><link rel="prefetch" href="/assets/js/94.8f1e3309.js"><link rel="prefetch" href="/assets/js/95.ea1c2085.js"><link rel="prefetch" href="/assets/js/96.08475163.js"><link rel="prefetch" href="/assets/js/97.a8c7442e.js"><link rel="prefetch" href="/assets/js/98.9d7ce618.js"><link rel="prefetch" href="/assets/js/99.eb0c7f6a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.06744937.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jerry 个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/js/index.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/css/index.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/basic/html/index.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/http/index.html" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue 系列" class="dropdown-title"><span class="title">Vue 系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/vue/vue2/index.html" class="nav-link">
  Vue 2
</a></li><li class="dropdown-item"><!----> <a href="/tools/vue/vue3/index.html" class="nav-link">
  Vue 3
</a></li><li class="dropdown-item"><!----> <a href="/tools/vue/vuex/index.html" class="nav-link">
  Vuex
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码精读" class="dropdown-title"><span class="title">源码精读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/snabbdom/index.html" class="nav-link">
  Snabbdom
</a></li><li class="dropdown-item"><!----> <a href="/tools/axios/index.html" class="nav-link">
  Axios
</a></li></ul></div></div><div class="nav-item"><a href="/backend/" class="nav-link">
  技能拓展
</a></div><div class="nav-item"><a href="/tools/webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About Me
</a></div> <a href="https://github.com/JerryYuanJ/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/js/index.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/css/index.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/basic/html/index.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/http/index.html" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue 系列" class="dropdown-title"><span class="title">Vue 系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/vue/vue2/index.html" class="nav-link">
  Vue 2
</a></li><li class="dropdown-item"><!----> <a href="/tools/vue/vue3/index.html" class="nav-link">
  Vue 3
</a></li><li class="dropdown-item"><!----> <a href="/tools/vue/vuex/index.html" class="nav-link">
  Vuex
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码精读" class="dropdown-title"><span class="title">源码精读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/snabbdom/index.html" class="nav-link">
  Snabbdom
</a></li><li class="dropdown-item"><!----> <a href="/tools/axios/index.html" class="nav-link">
  Axios
</a></li></ul></div></div><div class="nav-item"><a href="/backend/" class="nav-link">
  技能拓展
</a></div><div class="nav-item"><a href="/tools/webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About Me
</a></div> <a href="https://github.com/JerryYuanJ/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/js/data-compare.html" class="sidebar-link">数据类型转换</a></li><li><a href="/basic/js/reduce.html" class="sidebar-link">reduce方法详解</a></li><li><a href="/basic/js/fetch.html" class="sidebar-link">fetch方法详解</a></li><li><a href="/basic/js/request-animation-frame.html" class="sidebar-link">requestAnimationFrame</a></li><li><a href="/basic/js/debounce-throttle.html" class="sidebar-link">函数节流和防抖</a></li><li><a href="/basic/js/module.html" class="sidebar-link">前端模块化</a></li><li><a href="/basic/js/web-component.html" aria-current="page" class="active sidebar-link">Web Component &amp; Shadow DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#什么是-web-component" class="sidebar-link">什么是 Web Component</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#创建-web-component" class="sidebar-link">创建 Web Component</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#几个概念" class="sidebar-link">几个概念</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#创建组件" class="sidebar-link">创建组件</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#添加样式" class="sidebar-link">添加样式</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#添加事件处理" class="sidebar-link">添加事件处理</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#使用-template-来封装我们的组件" class="sidebar-link">使用 Template 来封装我们的组件</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#slot-插槽" class="sidebar-link">Slot 插槽</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#几个api的解释" class="sidebar-link">几个API的解释</a></li><li class="sidebar-sub-header"><a href="/basic/js/web-component.html#高级-组件的生命周期" class="sidebar-link">高级 - 组件的生命周期</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Coding With JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/js/promise.html" class="sidebar-link">实现Promise</a></li><li><a href="/basic/js/bind.html" class="sidebar-link">实现apply/call/bind</a></li><li><a href="/basic/js/new.html" class="sidebar-link">实现new操作符</a></li><li><a href="/basic/js/create.html" class="sidebar-link">实现Object.create()</a></li><li><a href="/basic/js/deep-clone.html" class="sidebar-link">实现深拷贝</a></li><li><a href="/basic/js/add-big-number.html" class="sidebar-link">实现大数相加</a></li><li><a href="/basic/js/sleep.html" class="sidebar-link">实现sleep功能</a></li></ul></section></li></ul> <div class="adsense-content" data-v-8d82fd90><div style="padding: 2rem" data-v-8d82fd90></div></div></aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web-component"><a href="#web-component" class="header-anchor">#</a> Web Component</h1> <h2 id="什么是-web-component"><a href="#什么是-web-component" class="header-anchor">#</a> 什么是 Web Component</h2> <p><code>Web Component</code>，翻译过来就是web组件，它实际上是<strong>一套</strong>让你可以创建可重用元素的技术。它将一个或多个元素封装到一起成为一个“新的”元素，这个新元素的功能、样式都与其他元素相互独立，互不干扰。</p> <p>这里说的<strong>一套</strong>技术主要是以下三个：</p> <ul><li><code>Custom Elements</code> 自定义元素。一组js的API，可以让你定义自定义元素，在界面上使用。</li> <li><code>Shadow DOM</code> 影子DOM。 一组js的API，可以将封装好的“影子”DOM添加到元素上。这个“影子”DOM是独立于主文档DOM渲染的，所以你不用担心内部的脚本或者样式会与外部的元素冲突。</li> <li><code>HTML Templates</code> HTML模板。<code>&lt;template&gt;</code>和<code>&lt;slot&gt;</code>元素可以让你编写不需要渲染到页面上的标记模板，它们可以作为自定义元素被重用很多次。</li></ul> <p>一个简单实现web组件的方法通常如下：</p> <ol><li>用一个类或者函数来定义你的web组件</li> <li>使用<code>CustomElementRegistry.define()</code>来注册你的自定义元素，给它传递一个元素名称，一个上面定义的类名或者函数名，还有一个可选的继承元素。</li> <li>如有必要的话，使用<code>Element.attachShadow()</code>方法把<code>shadom dom</code>添加到自定义元素上。</li> <li>如有必要的话，使用<code>&lt;template&gt;</code>和<code>&lt;slot&gt;</code>定义HTML模板。</li> <li>在页面上使用你新建的自定义元素吧～</li></ol> <h2 id="创建-web-component"><a href="#创建-web-component" class="header-anchor">#</a> 创建 Web Component</h2> <h3 id="几个概念"><a href="#几个概念" class="header-anchor">#</a> 几个概念</h3> <p>在学习如何创建组件之前，我们要了解几个相关的术语：</p> <ol><li><code>Shadow host</code> 一个常规DOM节点，Shadow DOM 会被附加到这个节点上</li> <li><code>Shadow tree</code> Shadow DOM内部的DOM树</li> <li><code>Shadow boundary</code> Shadow DOM结束的地方，也是常规 DOM开始的地方，一个概念上的边界</li> <li><code>Shadow root</code> Shadow tree的根节点</li></ol> <p>我们来看一下MDN上的一张图了解一下<code>Shadow DOM</code>与常规DOM的关系：</p> <img src="/assets/img/shadow-dom.9ef9232d.png" alt="Shadow DOM pic"> <p>注意，你可以使用操作常规DOM的方法来操作 <code>Shadow DOM</code>，比如添加子节点、设置属性，以及为节点添加自己的样式（例如通过 element.style 属性），或者为整个 Shadow DOM 添加样式（例如在 <code>&lt;style&gt;</code> 元素内添加样式）。不同的是，<code>Shadow DOM</code> 内部的元素始终不会影响到它外部的元素（除了 <code>:focus-within</code>），这为封装提供了便利。</p> <p><code>Shadow DOM</code> 并不是一项新技术，在过去的很长一段时间里，浏览器用它来封装一些元素的内部结构。比如H5中的 <code>&lt;video&gt;</code> 元素，你所能看到的只是一个 <code>&lt;video&gt;</code> 标签，实际上在它的 <code>Shadow DOM</code> 中，包含来一系列的按钮和其他控制器。<code>Shadow DOM</code> 标准允许你为你自己的元素<code>（custom element）</code>维护一组 <code>Shadow DOM</code>。</p> <p>接下来我们要创建一个简单的组件，它是一个带颜色的文本，我们可以像这样来使用它：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>colored-text</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>hello shadow dom<span class="token punctuation">'</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>green<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>colored-text</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="创建组件"><a href="#创建组件" class="header-anchor">#</a> 创建组件</h3> <p>我们使用ES6的类来定义这个组件，让它继承<code>HTMLElement</code>类</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ColoredText</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一个雏形就出现了，但是很显然，这个组件貌似什么也做不了，我们给它添加相应的功能。我们在<code>Shadom DOM</code>里可以像平常一样使用我们的DOM API，所以，我们可以这么来实现：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ColoredText</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建 shadow root，关于 mode 我们后面会讲到</span>
      <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建内部 DOM 树</span>
      <span class="token keyword">const</span> box <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
      <span class="token comment">// 获取 text 属性的值，没提供的话显示'default text'</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'default text'</span>
      <span class="token comment">// 获取 color 属性的值，没提供的话默认红色</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'red'</span>
      <span class="token comment">// 设置文字</span>
      box<span class="token punctuation">.</span>innerText <span class="token operator">=</span> text
      <span class="token comment">// 设置颜色</span>
      box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> color
      <span class="token comment">// 把内部的DOM树（本例就是一个span元素）添加到 Shadow Root上</span>
      root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>我们单纯的组件到此就定义完成了，要把它变成自定义元素，还需要接下来的操作：</p> <div class="language-js extra-class"><pre class="language-js"><code>customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'colored-text'</span><span class="token punctuation">,</span> ColoredText<span class="token punctuation">)</span>
</code></pre></div><p>我们可以使用它啦！什么都不传的话，它会采用默认值，来看看：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>colored-text</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>colored-text</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>效果应该是红色的&quot;default text&quot;的文本：</p> <img src="data:image/png;base64,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" alt="Shadow DOM demo1"> <p>给它传递一些参数试试：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>colored-text</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hello shadow dom<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>green<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>colored-text</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>效果：
<img src="data:image/png;base64,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" alt="Shadow DOM demo2"></p> <p>Nice！接下来我们可以慢慢的扩充这个例子的功能了。这个文字看上去太小了，我们给他放大一点吧。</p> <h3 id="添加样式"><a href="#添加样式" class="header-anchor">#</a> 添加样式</h3> <p>还是一样的，跟常规DOM没什么区别，平平无奇。我们采用两种方法来添加两种样式吧：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ColoredText</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建 shadow root，关于 mode 我们后面会讲到</span>
      <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建内部 DOM 树</span>
      <span class="token keyword">const</span> box <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
      <span class="token comment">// 获取 text 属性的值，没提供的话显示'default text'</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'default text'</span>
      <span class="token comment">// 获取 color 属性的值，没提供的话默认红色</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'red'</span>
      <span class="token comment">// 使用 style 标签 来修改字体大小</span>
      <span class="token keyword">const</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
      style<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        .big-font{
          font-size: 26px;
        }
      </span><span class="token template-punctuation string">`</span></span>
      <span class="token comment">// 设置文字</span>
      box<span class="token punctuation">.</span>innerText <span class="token operator">=</span> text
      <span class="token comment">// 设置颜色</span>
      box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> color
      <span class="token comment">// 用 style 的方式添加字体的 weight</span>
      box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontWeight <span class="token operator">=</span> <span class="token string">'bold'</span>
      <span class="token comment">// 添加类</span>
      box<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'big-font'</span><span class="token punctuation">)</span>
      <span class="token comment">// 一定要把这style标签添加到box上，不然上面的不会生效</span>
      box<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span>
      <span class="token comment">// 把内部的DOM树（本例就是一个span元素）添加到 Shadow Root上</span>
      root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>此时我们的文字应该明显变大变粗了，来看看效果：</p> <img src="/assets/img/shadow-dom-3.8898432a.png" alt="Shadow DOM demo3"> <p>当然，你肯定不会喜欢这种糟糕的代码，把结构与样式揉杂在一起。我们可以使用外部样式表，通过创建<code>link</code>标签把外部样式引进来，再直接给对应的元素设置样式类就行了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> linkElem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
linkElem<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'rel'</span><span class="token punctuation">,</span> <span class="token string">'stylesheet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
linkElem<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">,</span> <span class="token string">'style.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 一定要添加到shadow dom中！！否则不会生效。</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>linkElem<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>自己尝试一下吧！</p> <h3 id="添加事件处理"><a href="#添加事件处理" class="header-anchor">#</a> 添加事件处理</h3> <p>一样的平平无奇...</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//...</span>
<span class="token comment">// 添加事件处理</span>
box<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click me'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//....</span>
</code></pre></div><h3 id="使用-template-来封装我们的组件"><a href="#使用-template-来封装我们的组件" class="header-anchor">#</a> 使用 Template 来封装我们的组件</h3> <p>如果你有过vue项目的开发经验，你可能会有这样的疑问，为什么不可以把结构啊、样式啊之类的单独定义呢？就像vue单文件组件的<code>&lt;template&gt;</code>一样多么清晰明了啊！嘿！你还别说，还真有，而且，vue还是受到这个启发的。我们来用<code>template</code>重写上面的例子：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>colored-text</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hello shadow dom<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>green<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>colored-text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>color-text-tpl<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">.big-font</span><span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">span</span><span class="token punctuation">{</span>
        <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ColoredText</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建 shadow root，关于 mode 我们后面会讲到</span>
      <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 获取 template 元素</span>
      <span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'color-text-tpl'</span><span class="token punctuation">)</span>
      <span class="token comment">// 这个 templateContent 是一个 DocumentFragment</span>
      <span class="token keyword">const</span> templateContent <span class="token operator">=</span> template<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
      <span class="token comment">// 创建内部 DOM 树</span>
      <span class="token keyword">const</span> box <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
      <span class="token comment">// 获取 text 属性的值，没提供的话显示'default text'</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'default text'</span>
      <span class="token comment">// 获取 color 属性的值，没提供的话默认红色</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'red'</span>
      <span class="token comment">// 设置文字</span>
      box<span class="token punctuation">.</span>innerText <span class="token operator">=</span> text
      <span class="token comment">// 设置颜色</span>
      box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> color
      <span class="token comment">// 直接使用 &lt;style&gt; 标签里的样式</span>
      box<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'big-font'</span><span class="token punctuation">)</span>
      <span class="token comment">// 添加事件处理</span>
      box<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click me'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 把 box 添加到 template 中</span>
      templateContent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span>
      <span class="token comment">// 克隆 template 后，追加到 root 上</span>
      root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>templateContent<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>我们在<code>&lt;template&gt;</code>中定义样式，在自定义元素中直接使用这个样式。我们创建的<code>span</code>直接是追加到<code>template</code>上的，最后把这个<code>template</code>克隆后追加到<code>shadow root</code>上，其他的没什么变化，效果还是一样的：</p> <img src="/assets/img/shadow-dom-3.8898432a.png" alt="Shadow DOM demo4"> <p>我们思考一下，这样做的好处是什么呢？因为代码量看上去没多大的改变啊。</p> <p>实际上，这里的模板，已经被我们抽取出来了，也就是说它是可以重用的。对于业务场景复杂的情况，我们我们抽取出业务上最基础的模板，被其他自定义组件使用。这无疑是一项很大的突破。并且，我们在模板里编写样式，这个样式仅在模板里起作用，不会污染到外部的DOM，体现了很强的封装性。光这两点就很令人兴奋了。别急，它还有一个更令人兴奋的功能 —— <code>Slot</code>插槽！</p> <h3 id="slot-插槽"><a href="#slot-插槽" class="header-anchor">#</a> Slot 插槽</h3> <p>插槽实际上提供的是一个占位符的功能，它很简单，同时也十分灵活。vue的插槽机制也是借鉴于此，只不过vue是通过VDOM来实现的。我们在原先的例子上添加一个标题和描述信息。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>colored-text</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hello shadow dom<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>green<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>描述<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>colored-text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>color-text-tpl<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">.big-font</span><span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">span</span><span class="token punctuation">{</span>
        <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">[name='title']</span><span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">[name='desc']</span><span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>不需要修改js，只要改动模板即可。我们添加了两个命名插槽，分别设置来不同的样式，并且在使用组件的时候定义了这两个插槽，一起来看看效果：</p> <img src="/assets/img/shadow-dom-4.057e189b.png" alt="Shadow DOM demo5"> <p>到此为止，关于如何创建一个<code>Web Component</code>的介绍就结束了。目前前端开发的大势也是组件化开发，像<code>Vue</code>、<code>React</code>等和基于它们的很多优秀插件，都是组件化的最佳实践。它带来的好处不言而喻：重用性更高的代码，更丰富的插件库，维护性更高的系统...我们在实际的开发中，也要利用这种思想，合理的拆分出系统中的各个组件，让系统体会到组件化的优势。</p> <h3 id="几个api的解释"><a href="#几个api的解释" class="header-anchor">#</a> 几个API的解释</h3> <ol><li><code>this.attachShadow()</code></li></ol> <p>它给指定的元素挂载一个<code>Shadow DOM</code>，并且返回对<code>ShadowRoot</code>的引用。它接收一个初始化对象作为参数，这个对象包含以下字段：</p> <ul><li><code>mode</code></li></ul> <p>这个很简单，值为<code>open</code>的话，外部的js可以访问到这个<code>shadowRoot</code>对象；为<code>closed</code>的话，访问<code>shadowRoot</code>的话会得到<code>null</code></p> <ul><li><code>delegatesFocus</code></li></ul> <p>这是一个布尔值, 当设置为 <code>true</code> 时, 指定减轻自定义元素的聚焦性能问题行为。当<code>shadow DOM</code>中不可聚焦的部分被点击时, 让第一个可聚焦的部分成为焦点, 并且<code>shadow host</code>将提供所有可用的<code>:focus</code>样式。这个属性很少用。</p> <p>要注意的是，不是每一种类型的元素都可以附加到<code>shadow root</code>下面。出于安全考虑，一些元素不能使用<code>shadow DOM</code>（例如<code>&lt;a&gt;</code>），以及许多其他的元素。具体的可以参考MDN文档。</p> <ol start="2"><li><code>customElements.define()</code></li></ol> <p>用来自定义组件的，它接收三个参数：自定义组件的名称，组件构造函数，一个可选的属性（可以用来指定继承的父元素）。</p> <h3 id="高级-组件的生命周期"><a href="#高级-组件的生命周期" class="header-anchor">#</a> 高级 - 组件的生命周期</h3> <p>无论是在<code>Vue</code>还是其他的前端框架中，组件肯定都有它的生命周期，我们可以在组件不同的阶段针对性的做不同的事。<code>Web Component</code>包含以下几个生命周期：</p> <ul><li><p><code>connectedCallback</code> 当组件与真实的DOM建立连接的时候调用</p></li> <li><p><code>disconnectedCallback</code> 当组件与真实的DOM失去连接的时候调用</p></li> <li><p><code>adoptedCallback</code> 当组件被移动到一个新文档的时候调用</p></li> <li><p><code>attributeChangedCallback</code> 组件的属性修改时调用</p></li></ul> <p>具体的读者可以打印出一点东西看看，什么时机会调用什么样的方法。后面我会单独写一篇来介绍这些生命周期的用法。</p> <p><strong>参考文档</strong></p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_templates_and_slots" target="_blank" rel="noopener noreferrer">MDN - Using_templates_and_slots<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements" target="_blank" rel="noopener noreferrer">MDN - Using_custom_elements<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM" target="_blank" rel="noopener noreferrer">MDN - Using_shadow_DOM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/23/2020, 11:25:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/basic/js/module.html" class="prev">
        前端模块化
      </a></span> <span class="next"><a href="/basic/js/promise.html">
        实现Promise
      </a>
      →
    </span></p></div> <div class="adsense-content" data-v-5abe131a><div style="padding: 2rem 2rem 1rem 2rem" data-v-5abe131a></div></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.60e74413.js" defer></script><script src="/assets/js/14.69f023c0.js" defer></script><script src="/assets/js/2.720ba71e.js" defer></script><script src="/assets/js/12.aeedaf60.js" defer></script>
  </body>
</html>
